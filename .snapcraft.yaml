name: nicotine
adopt-info: nicotine
license: GPL-3.0+

base: core22
confinement: strict
compression: lzo

apps:
  nicotine:
    environment:
      SNAPCRAFT_PRELOAD_REDIRECT_ONLY_SHM: 1
    command: bin/snapcraft-preload python3 -m pynicotine
    common-id: org.nicotine_plus.Nicotine
    desktop: share/applications/org.nicotine_plus.Nicotine.desktop
    extensions: [gnome]
    plugs:
      - home
      - network
      - removable-media

parts:
  snapcraft-preload:
    source: https://github.com/sergiusens/snapcraft-preload.git
    plugin: cmake
    cmake-parameters:
      - -DCMAKE_INSTALL_PREFIX=/
    build-packages:
      - on amd64:
        - gcc-multilib
        - g++-multilib
  nicotine:
    plugin: python
    source: .
    parse-info: [share/metainfo/org.nicotine_plus.Nicotine.appdata.xml]

slots:
  nicotine:
    interface: dbus
    bus: session
    name: org.nicotine_plus.Nicotine
